---
title: 微服务架构学习01-初探微服务架构
tags: [微服务]
---
# 微服务架构学习01-初探微服务架构
本系列文章为极客时间课程《从0开始学微服务》课程记录。
## 微服务整体架构
![断路器视图](/images/wfwjg01_ztjg.png)<br/>
依据上图微服务架构主要依赖以下基本组件：
- 服务描述
- 注册中信
- 服务框架
- 服务监控
- 服务追踪
- 服务治理
## 服务描述
对外提供一个服务，那么服务名是什么，调用服务需要提供哪些信息，调用服务的返回结果是什么，如何解析？这是服务描述所要解决的问题。   
常用服务描述包括Restful API,XML以及IDL文件三种。  

Restful API常用wiki或者Swagger进行管理。   
XML配置方式主要用作RPC协议服务描述。  
IDL文件常用作Thrift和gRPC跨语言服务调用。   


## 注册中心
有了服务接口的描述，下一步要解决服务的发布和订阅，服务提供者将自己提供的服务以及地址登记到注册中心，服务消费者则从注册中心查询所需要调用的服务的地址，然后发起调用。   
工作流程：
- 服务提供者启动时，根据服务发布文件中配置的发布信息向注册中心注册服务。
- 服务消费者启动时，根绝消费者配置文件中配置的服务信息向注册中心订阅自己需要的服务。
- 注册中心返回服务提供者地址列表给服务消费者。
- 当服务提供者发送变化，比如节点新增或者销毁，注册中心将变更通知到服务消费者。

## 服务框架
发起调用前需要解决的问题如下：
- 服务通信采用什么协议？TCP UDP还是HTTP。
- 数据传输采用什么方式，同步异步？
- 数据压缩采用什么格式，JSON、java对象序列化、Protobuf序列化等。

## 服务监控
服务监控主要包括三个流程：
- 子表收集。把每一次调用的耗时以及成功与否收集起来，上传到集中的数据处理中心。
- 数据处理。有了上一步收集到的信息，就可以计算出每秒服务请求量、平均耗时以及成功率。
- 数据展示。将数据展示在Dashborad上，每隔10秒自动刷新展示，用作业务监控和报警等。


## 服务追踪
除了对服务调用情况进行监控外，需要记录服务调用的每一层链路，以便进行问题追踪和故障定位。
工作原理：
- 消费者发起调用前，本地生成reqid,发起调用时，将reqid作为请求参数一部分传给生产者。
- 生产者接收到请求后，记录下这次请求的reqid，然后处理请求。如果生产者继续请求其他服务，本地再生成自己的一个reqid，然后当做请求参数继续往下传。   

## 服务治理
服务监控发现问题，服务追踪能够定位问题，解决问题就需要服务治理了。服务治理就是通过一系列手段保证各种意外情况下，服务调用仍然能够正常进行。
### 单机故障
服务治理通过一定的策略，自动摘除故障节点，不需要人工干预，就能保证单机故障不会影响业务。
### 单IDC故障
服务治理可以通过自动切换故障IDC的流量到其他正常IDC。
### 依赖服务不可用
服务治理可以通过限流 ，在依赖服务异常的情况下，一段时间内停止发起调用而直接返回。一方面保证消费者能够不被拖垮，另一方面也给服务提供者减少了访问压力。
 
## 总结
在引入微服务脚骨之前，团队必须掌握这些基本组件的原理并具备开发能力，中小团队建议直接用开源方案。




## 参考
[ 初探微服务架构](https://time.geekbang.org/column/article/14222)
















































































































