---
title: 微服务设计笔记07
tags: [微服务]
---
# 微服务设计笔记07
本篇笔记为微服务设计系列读书笔记的第七篇，主要记录微服务系统的测试。
## 测试类型
首先引入测试象限的概念，参见下图。
![测试象限](/images/wfw07_csxx.png)<br/> 
注意图中下方，面向技术的测试，这些测试都可以使用自动工具完成。
## 测试范围
![测试金字塔](/images/wfw07_csjzt.png)<br/> 
### 单元测试
单元测试通常只测试一个函数或者方法调用。单元测试彼此独立，分别覆盖一些小范围的代码。

### 服务测试
绕开用户界面，直接针对服务的测试。多个服务的系统，一个服务测试只测试一个单独的服务的功能。需要给所有的外部合作者打桩。
![服务测试](/images/wfw07_fwcs.png)<br/>  

### 端到端测试
端到端测试会覆盖整个系统。
![服务测试](/images/wfw07_dddcs.png)<br/>  

### 测试比例
从测试金字塔向上，测试覆盖的范围越来越大，但是测试要花的时间，测试定位问题的难度也越来越大。  
顺着测试金字塔，从金字塔向下，下面一层的测试数量要不上面一层多一个数量级。  

## 实现服务测试
作者推荐了Mountebank mock服务器。

## 脆弱的测试
有些测试失败不是因为功能失败，比如多线程之间的竞争，临时网络故障。脆弱测试的定义：包含在测试中的服务数量越多，测试就会越脆弱，不确定性就会越强。如果测试失败后每个人都只想重新运行一遍测试，然后希望可能会通过，那么这种测试就是脆弱的。  

## 测试场景
把测试系统的重心放到少量核心的场景上来。把任何在这些核心场景之外的功能放在相互隔离的服务测试中覆盖。

## 部署后再测试
![蓝绿部署](/images/wfw07_lvbs.png)<br/>

蓝绿部署前提条件：能够切换生产流量到不同的主机，最好能够零宕机部署。

## 金丝雀发布
金丝雀发布：将部分生产流量引流到新部署的系统，来验证系统是否按预期执行。金丝雀发布与蓝绿发布的不太之处：新旧版本共存时间更长，而且经常会调整流量。  








































