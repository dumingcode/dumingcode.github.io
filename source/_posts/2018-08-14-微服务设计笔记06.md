---
title: 微服务设计笔记06
tags: [微服务]
---
# 微服务设计笔记06
本篇笔记为微服务设计系列读书笔记的第六篇，主要记录微服务系统的部署。
## 持续集成简介
CI(Continuous Integration持续集成)。CI能够保证新提交的代码与已有代码进行集成，从而让所有人保持同步。CI服务器会检测到代码已提交并签出，并能验证代码是否通过编译以及测试是否通过。判断是否真正理解CI三个问题：
1. 是否每天签入代码到主线。需要频繁把代码捡入到单个主线分支中。
2. 需要有一组测试数据用来验证修改。没有对代码进行验证的CI不是真正的CI。
3. 构建失败后，团队是否把修复CI当作第一优先级的事情来做。

## 把持续集成映射到微服务
如何在微服务、CI构建、以及源代码之间建立合适的映射？   
建议采用下图所示的方式，每个微服务有一个单独的代码库，并分别于相应的CI绑定。这样就可以在将该服务部署到生产环境之前有一个快速的验证。每个微服务相关的测试也应该和其本身的代码放在一起。

![每个微服务有自己单独的构建](/images/wfw6_ci.png)<br/> 

## 构建流水线和持续交付
构建流水线：（1）第一个阶段运行快速测试（2）第二个阶段运行耗时测试。    
CD（continous delivery）CD检查每次提交是否满足部署到生产环境的要求。
![微服务流水线](/images/wfw06_lsx.png)<br/>   

## 服务与主机之间的映射
单个主机上部署多个服务，增加了对单个服务进行扩展的复杂性。  
应用程序容器缺点：
1. 限制技术栈的选择，限制自动化和系统管理技术的选择。
2. 多个程序在一个同一个进程中，分析资源的使用和线程也非常复杂。   
每个主机一个服务：简化问题排查。   
推荐使用Docker。

















