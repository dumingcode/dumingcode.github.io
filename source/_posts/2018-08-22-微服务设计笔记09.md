---
title: 微服务设计笔记09
tags: [微服务]
---
# 微服务设计笔记09
本篇笔记为微服务设计系列读书笔记的第八篇，主要记录微服务系统的安全。  
## 身份验证与授权

主体：抽象地讨论进行身份验证的人或事时。不希望每个人使用不同的用户名和密码来登陆不同的系统。目的是要有一个单一的标识且只需要一次验证。  

### 常见的单点登录实现
企业级领域中占据统治低位单SAML和Openid Connect，后者是未来的方向。  
### 单点登录网关
可以使用服务与外部世界的网关作为代理，而不是让每个服务管理者与身份提供者进行握手。基本想法：集中处理重定向用户的行文，并且只在一个地方执行握手。
![单点登录网关](/images/wfwsj09_dddlwg.png)<br/> 

解决下游服务如何接受主体信息的问题，比如用户名和角色。可以把信息放到http header上，参考工具`shibboleth`。   

### 细粒度的授权
网关可以提供粗粒度的身份验证。

## 服务间的身份验证和授权
1. 在边界内允许一切
在边界内对任何调用都是默认可信的。
2. HTTPS基本身份验证
3. 使用SAML和OpenID
4. 客户端证书 TLS
5. HTTP之上的HMAC
6. API秘钥
![单点登录网关](/images/wfwsj09_wg.png)<br/> 
7. 代理问题

## 静态数据的安全
基本的需要遵循的东西：
1. 使用众所周知的加密算法，密码需要考虑使用加盐密码哈希。
2. 一切皆与秘钥相关。

## 深度防御
1. 防火墙
2. 日志（聚合多个系统的日志）
3. 入侵检测和预防系统
4. 网络隔离。把微服务放在不同的网段，控制服务间的通信。
5. 操作系统，及时打补丁。

## 一个示例
![单点登录网关](/images/wfwsj09_sl.png)<br/> 
针对浏览器无需安全保护的内容使用标准的HTTP，以便能够缓存。对于有安全需要，登陆后才可访问的页面，所有的内容通过HTTPS传输。

## 黄金法则
1. 不要实现自己的加密算法。
2. 不要发明自己的安全协议。

## 自动化工具
1. ZAP 跨站脚本攻击
2. OWASP 











































