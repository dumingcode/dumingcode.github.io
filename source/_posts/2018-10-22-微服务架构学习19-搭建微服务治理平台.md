---
title: 微服务架构学习19-搭建微服务治理平台
tags: [微服务]
---
# 微服务架构学习19-搭建微服务治理平台
## 微服务治理平台的基本功能
![微服务治理平台基本功能](/images/wbwfwsj18_zlzx.png)<br/>

### 服务管理
在微服务治理平台，调用**注册中心**提供的接口实现服务的管理。一般包括：
- 服务上下线
- 节点添加/删除
- 服务查询
- 服务节点查询

### 服务治理
通过微服务治理平台，可以调用**配置中心**提供的接口，动态地修改各种配置来实现服务的治理。
- 限流。系统出现流量爆发时，修改阈值，给核心服务流出充足的冗余度。
- 降级。
- 切流量。

### 服务监控
微服务治理一般包括两个层面的监控。一个是整体监控，比如服务依赖的拓扑图。一个是具体服务的监控，比如服务的QPS等指标。整体监控使用服务追踪系统提供的服务依赖拓扑图，具体服务监控可以通过Grafana等监控系统UI展示。

### 问题定位
微服务治理平台实现问题定位，通过两个层面。一个是宏观层面，通过服务监控发掘异常，比如某个服务的平均耗时异常导致调用失败。一个是微观层面，通过服务追踪来具体定位一次用户请求失败具体是因为服务调用链路的哪一层导致的。  

### 日志查询
可以通过接入类似ELK，实时查询某个用户的请求详细信息。  

### 服务运维
微服务治理平台可以调用容器管理平台，实现常见运维操作。服务运维主要包括：
- 发布部署。服务功能有变更时，需要重新发布部署时，调用容器管理平台分批按比例进行重新部署，然后发布到线上。
- 扩缩容。流量增加或减少时，相应增加或缩减服务在线上的部署实例。


## 如何搭建微服务治理平台
微服务治理平台之所以能够实现上面所说的功能，在于它能够封装对微服务架构内的各个基础设施组件的调用，从而对外提供统一的服务操作API，还提供了可视化的界面，方便操作。    

治理平台主要包括：Web Portal层、API层以及数据库DB层。  

### Web Portal

![微服务治理平台架构](/images/wbwfwsj19_zlsj.png)<br/>
- 服务管理界面
![微服务治理平台管理界面](/images/wbwfwsj19_zlptfwtj.png)<br/>
- 服务治理界面
![微服务治理平台服务治理界面](/images/wbwfwsj19_zlptfwzl.png)<br/>
- 服务监控界面
![微服务治理平台管理服务监控界面](/images/wbwfwsj19_zlptfwjk.png)<br/> 

### API
主要提API供Web Portal调用。一般包括如下接口：
- 添加服务接口，针对注册中心。
- 删除服务接口，针对注册中心。
- 服务降级/限流/切流量接口，针对配置中心。
- 服务扩缩容接口，调用容器平台提供的扩缩容接口。
- 服务部署接口，调用容器平台提供的上线部署接口。

### DB层
治理平台本身要存储一些数据，主要分以下三种：
- 用户权限。一般分为可浏览、可更改以及管理员权限。可以对权限做下细分，按照不同服务的负责人进行权限划分。
- 操作记录。记录用户做的变更操作。
- 元数据。主要用来把服务在各个系统中对应的记录映射到微服务治理平台中，统一进行管理。比如某个服务在监控系统中可能有个特殊标志，在注册中心又用到了另一个标志，为了统一就需要在微服务治理平台进行统一转换，然后进行数据串联。



## 总结
微服务治理平台主要将微服务的各个基础设施整合在一起，目前大部分开源服务框架都没有这个统一的服务治理平台。  





















































 





























































